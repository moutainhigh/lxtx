<html lang="zh-CN" class="pixel-ratio-2 retina android android-6 android-6-0"><head>
    <title>{$book['title']}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="__MODULE_CSS__/vendor.css">
    <link rel="stylesheet" href="__MODULE_CSS__/front.css">
    <script src="__MODULE_JS__/vendor.js?20170823"></script>
    <script src="__MODULE_JS__/app.js"></script>
   <!--  <script>
     $.ajaxSetup({
       beforeSend: function (xhr)
       {
         var token = Cookies.get('member_token');
         if (token) {
           xhr.setRequestHeader('Authorization', 'Bearer ' + token);
         }
       }
     });
   </script> -->
    <link href="__MODULE_CSS__/font_apds0v8n2bhp8pvi.css?20170918" rel="stylesheet">
    <style>
      body,html{-webkit-tap-highlight-color:transparent}body{overflow-x:hidden;background-color:#fbf9fe}.container{height:100%;overflow-y:auto;-webkit-overflow-scrolling:touch}.container>div{background-color:#fbf9fe}.hd{padding:1.5em 0}.page_title{text-align:center;font-size:24px;color:#3cc51f;font-weight:400;margin:0 15%}.page_desc{text-align:center;color:#888;font-size:14px}.bd.spacing{padding:0 15px}.home{padding-bottom:30px}.button .page_title{color:#225fba}.button .bd{padding:0 15px}.button .button_sp_area{padding:10px 0;width:60%;margin:0 auto;text-align:justify;text-justify:distribute-all-lines;font-size:0}.button .button_sp_area:after{display:inline-block;width:100%;height:0;font-size:0;margin:0;padding:0;overflow:hidden;content:"."}.cell .page_title{color:#225fba}.cell .bd{padding-bottom:30px}.dialog .bd,.toast .bd{padding:120px 15px 0}.msg{background-color:#fff}.panel .bd{padding-bottom:20px}.article{background-color:#fff}.article .page_title{color:#de7c23}.icons{background-color:#fff;text-align:center}.icons .page_title{color:#3e24bd}.icons .bd{padding:30px 0;text-align:center}.icons .icon_sp_area{padding:10px 20px;text-align:left}.icons i{margin:0 5px 10px}.tabbar{height:100%}.search_show{display:none;margin-top:0;font-size:14px}.search_show .weui_cell_bd{padding:2px 0 2px 20px;color:#666}.icon{display:inline-block;width:28px;height:28px;vertical-align:middle}.icon_button{background:url(images/icon_nav_button.png) no-repeat;background-size:28px 28px}.icon_cell{background:url(images/icon_nav_cell.png) no-repeat;background-size:28px 28px}.icon_toast{background:url(images/icon_nav_toast.png) no-repeat;background-size:28px 28px}.icon_dialog{background:url(images/icon_nav_dialog.png) no-repeat;background-size:28px 28px}.icon_progress{background:url(images/icon_nav_progress.png) no-repeat;background-size:28px 28px}.icon_msg{background:url(images/icon_nav_msg.png) no-repeat;background-size:28px 28px}.icon_article{background:url(images/icon_nav_article.png) no-repeat;background-size:28px 28px}.icon_actionSheet{background:url(images/icon_nav_actionSheet.png) no-repeat;background-size:28px 28px}.icon_icons{background:url(images/icon_nav_icons.png) no-repeat;background-size:28px 28px}.icon_panel{background:url(images/icon_nav_panel.png) no-repeat;background-size:28px 28px}.icon_tab{background:url(images/icon_nav_tab.png) no-repeat;background-size:28px 28px}.icon_search_bar{background:url(images/icon_nav_search_bar.png) no-repeat;background-size:28px 28px}@-webkit-keyframes a{0%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes a{0%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes b{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);opacity:0}}@keyframes b{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);opacity:0}}.enter,.leave{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1}.enter{-webkit-animation:a .2s forwards;animation:a .2s forwards}.leave{-webkit-animation:b .25s forwards;animation:b .25s forwards}.weui_btn_primary:not(.weui_btn_disabled):active {
    color: hsla(0,0%,100%,.4);
    background-color: #039702;.weui_btn_primary:not(.weui_btn_disabled):visited {
    color: #fff;
}
front.css:1
.weui_btn_primary {
    background-color: #10AEFF;
}
vendor.css:5
.weui_btn_primary {
    background-color: #04be02;
}
}
    </style>
  </head>
  <body class="page-read color-none ">
    <style>
    .weui_article {
        margin-bottom: 30px;
        font-size: 18px;
        font-weight: normal;
        line-height: 170%;
    }

    .weui_article p {
        margin: .7em 0;
        text-indent: 2em;
    }
</style>
<div class="container" style="padding-bottom:0">
    <div class="article" id="article-main" style="overflow-y:auto">
        <div class="hd">
            <h1 class="page_title">{$document.title}</h1><!--第{$document.idx}章-->
        </div>
        <div class="bd">
                        <div class="novel-meta clearfix">
                <div class="novel-avatar">
                    <img src="{$book.image|get_thumb}">
                </div>
                <div class="novel-info">
                    <a class="novel-title" href="{:url('cms/column/indexidx', ['bid' => $document['bid']])}">{$book.title}</a>
                </div>
            </div>
                        <article class="weui_article">
                <section>
                                       {$document.content|default=""}
                                    </section>
            </article>
            <div style="margin-bottom:60px;margin-top:-20px;display:none" id="subscribe-panel">
                <a class="weui_btn weui_btn_primary btn-subscribe" style="width:40%;" href="javascript:;">追 书</a>
            </div>

            <div class="article-foot-actions" style="position:fixed;bottom:0;background-color:#F5F5F5;width:100%;margin:0;padding:0">
                <a class="weui_btn btn-prev-article" href="{$prev.url|default='javascript:void(0)'}">上一章节</a>
                                <i id="menu" class="iconfont icon-bars"></i>
                <a class="weui_btn btn-next-article" href="javascript:;" data-url="{$next.url|default='javascript:void(0)'}">下一章节</a>
            </div>



        </div>
    </div>
</div>

<script type="text/html" id="template-dialog-fonts">
    <div class="weui_panel weui_panel_access">
        <a href="javascript:;" data-size="small" class="weui_grid fonthover">
            <p class="weui_grid_label">
                小
            </p>
        </a>
        <a href="javascript:;" data-size="medium" class="weui_grid fonthover">
            <p class="weui_grid_label">
                中
            </p>
        </a>
        <a href="javascript:;" data-size="large" class="weui_grid fonthover">
            <p class="weui_grid_label">
                大
            </p>
        </a>
    </div>
</script>
<script type="text/html" id="template-dialog-bg">
    <div class="weui_panel weui_panel_access">
        <a href="javascript:;" data-color="none" class="weui_grid bghover">
            <p class="weui_grid_label">
                无
            </p>
        </a>
        <a href="javascript:;" data-color="comfortable" class="weui_grid bghover">
            <p class="weui_grid_label">
                舒适
            </p>
        </a>
        <a href="javascript:;" data-color="dark" class="weui_grid bghover">
            <p class="weui_grid_label">
                黑夜
            </p>
        </a>
    </div>
</script>

<script>
    $(function () {
        var strToday = getTodayString();

        // 检查是否签到过
        var lastCheckinDate = window.localStorage.getItem('last_checkin_date');
        if (lastCheckinDate !== strToday) {
            checkin();
        }

        function checkin() {
            $.ajax({
                url: '/index.php/cms/document/addcore/',
                type: 'POST',
                contentType: 'application/json'
            })
                .then(function (result) {
                    setCheckedIn();
					$.modal({
                        title: '签到成功',
                        text: '<p>每日首次阅读, 赠送 <span style="color:orangered">50</span> 书币</p>' +
                        '<p style="margin-top:10px">请明日继续签到哦</p>',
                        buttons: [
                            {text: '我知道啦'}
                        ]
                    })
                })
                .fail(function (xhr) {
                    var result = JSON.parse(xhr.responseText);
                    // 如果是未关注用户, 第一天无需自动签到, 标记为已签到,以减少后续 API 请求
                    // 如果是重复签到, 说明用户可能是在新设备访问, 补充标记
                    if (result.code === 'not_subscribed' || result.code === 'already_checked_in') {
                        setCheckedIn();
                    }
                });
        }

        function getTodayString() {
            var date = new Date();
            return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
        }

        function setCheckedIn() {
            window.localStorage.setItem('last_checkin_date', strToday);
        }
    });
</script>
<script type="text/html" id="tmpl-gifts">
  <ul class="actionsheet-tip">
    {{#each gifts}}<li>
      <a class="btn-gift" data-gift-id="{{id}}">
        <img src="{{img_url}}" alt="{{title}}">
        <span class="text"><span class="price">{{wealth}}</span>书币</span>
      </a>
    </li>{{/each}}
  </ul>
</script>

<!--打赏-->
<script>
  (function (global) {
    var gifts = [{"id":1,"title":"\u9c9c\u82b1","img_url":"\/public\/static\/cms\/img\/gift_1.jpg","wealth":100},{"id":2,"title":"\u638c\u58f0","img_url":"\/public\/static\/cms\/img\/gift_2.jpg","wealth":388},{"id":3,"title":"\u94bb\u6212","img_url":"\/public\/static\/cms\/img\/gift_3.jpg","wealth":588},{"id":4,"title":"\u6e38\u8f6e","img_url":"\/public\/static\/cms\/img\/gift_4.jpg","wealth":888}];

    global.Tip = function () { };

    _.extend(Tip.prototype, {
      open: function () {
        var me = this;
        $.actions({
          title: '打赏',
          actions: [{
            className: 'bg-white',
            text: HandlebarTemplates.get('tmpl-gifts')({
              gifts: gifts
            })
          }]
        });

        $('.actionsheet-tip').on('click', '.btn-gift', function () {
          var gift = _.find(gifts, { id: parseInt($(this).data('gift-id')) });
          // 由于当actionshhet关闭时，jquery-weui会将modal的遮罩css也一起删除，因此需要做这个hack
          // https://github.com/lihongxun945/jquery-weui/blob/master/src/js/action.js#L50
          setTimeout(function () {
            me.create(gift);
          }, 50);
        });
      },
      create: function (gift) {
        var me = this;
        $.actions({
          title: '确定打赏?',
          actions: [{
            text: '确定',
            className: 'color-primary',
            onClick: function () {
              $.ajax({
                url: '/index.php/cms/document/tips',
                type: 'POST',
                dataType: 'JSON',
                contentType: 'application/json',
                data: JSON.stringify({
                  gift_id: gift.id,
                  novel_id: {$document.id}
                })
              })
              .then(function (payload) {
                $.toast('打赏成功');
                $(document).trigger('inovel.tip.created', payload.data);
              })
              .fail(function (error) {
                // 余额不足
                if (error.responseJSON.code === 9999) {
                  me.recharge(gift);
                } else {
                  $.toast(error.responseJSON.message, 'forbidden');
                }
              });   
            }
          }]
        });
      },
      recharge: function (gift) {
        $.modal({
          title: "余额不足",
          text: " 是否前往充值?",
          buttons: [{ 
            text: "立即充值",
            onClick: function () {
              window.onpageshow = function (e) {
                if (e.persisted) {
                  location.reload();
                }
              };

              location.assign('/index.php/cms/pay/index/');
            }
          }, { 
            text: "取消",
            className: "default"
          }]
        });
      }
    });
  })(window);
</script>







<!--<script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>-->
<script>
    var articleId = {$document.id};
    var __title = "{$document.title}";
    var _lk = "";
    var __BASE = "http://t1.ieasynet.net/";

    var prev_article_id = 0;
    var novel_id = 51;
    var from = '';
    //点击下一张是否提示
    var showFollowPopupOnNext = {$isgz.showFollowPopupOnNext};
    //底部按钮提示
    var forceFollow = {$isgz.forceFollow};
    var tiaozhuan = {$isgz.tiaozhuan};

    function addBookmark() {
        $.ajax({
            url: '/index.php/cms/document/addbookmark/id/' + articleId,
            type: 'GET',
            contentType: 'application/json'
        })
            .then(function () {
                $.toast('书签添加成功', 1000);
            });
    }

    function openFontsDialog() {
        $.modal({
            title: '字体大小',
            text: $('#template-dialog-fonts').html(),
            buttons: [
                { text: '确定' }
            ]
        });
    }

    function openBackgroundDialog() {
        $.modal({
            title: '背景颜色',
            text: $('#template-dialog-bg').html(),
            buttons: [
                { text: '确定' }
            ]
        });
    }

    function applyFontSize(size) {
        switch (size) {
            case 'large':
                $(".weui_article").css('font-size', "24px");
                break;
            case 'medium':
                $(".weui_article").css('font-size', "20px");
                break;
            case 'small':
                $(".weui_article").css('font-size', "16px");
                break;
        }
    }

    function applyBackground(bg) {
        $('body').removeClass('color-dark').removeClass('color-comfortable');
        if (bg !== 'none') {
            $('body').addClass('color-' + bg);
        }
    }

    $(document).ready(function () {

        var tip = new Tip();

        // tip
        var hash = qs2hash(location.search);
        if (hash['tip']) {
            tip.open();
        }

        
        $('#menu').click(function () {
            var actions = [];

            actions.push({
                text: '<i class="iconfont icon-text"></i> 字体大小',
                onClick: openFontsDialog
            });
            actions.push({
                text: '<i class="iconfont icon-color"></i> 背景颜色',
                onClick: openBackgroundDialog
            });
            actions.push({
                text: '<i class="iconfont icon-bookmark"></i> 添加书签',
                onClick: addBookmark
            });

            actions.push({
                text: '<i class="iconfont icon-dashang"></i><span>我要打赏</span>',
                onClick: function () {
                    tip.open();
                }
            });

            actions.push({
                text: '<i class="iconfont icon-menu"></i> 返回目录',
                onClick: function () {
                    location.href = "/index.php/cms/column/indexidx/id/5/bid/{$document['bid']}.html";
                }
            });

            actions.push({
                text: '<i class="iconfont icon-home"></i> 返回首页',
                onClick: function () {
                    location.href = "{:url('cms/index/index')}";
                }
            });

            $.actions({
                actions: actions
            });
        });

        $(document).on('click', '.bghover', function () {
            var bg = $(this).data('color');
            applyBackground(bg);
            Cookies.set('bg', bg, { expires: 3 * 365 * 24 * 60 * 60 });
            return false;
        });

        $(document).on('click', '.fonthover', function () {
            var size = $(this).data('size');
            applyFontSize(size);
            Cookies.set('size', size, { expires: 3 * 365 * 24 * 60 * 60 });
            return false;
        });

        $('.btn-next-article').click(function () {
        	  if(tiaozhuan){
        	  	location.href = "{$isgz.ewm}";
        	  }
            else if (showFollowPopupOnNext) {
                    $.modal({
                        title: '长按识别作者授权公众号继续阅读',
                        text: '<div style="font-size:16px;color:#333">' +
                        '<div style="margin:5px auto;color:red">由于版权问题，<br/>请扫下方二维码继续阅读</div>' +
                        '<img src="{$isgz.ewm}" style="width:70%"/>' +
                        '<div style="font-weight:bold;font-size:18px">长按上图识别二维码</div>' +
                        '</div>'
                    });

                    $('.weui_dialog').css('top', '20%');
            } else {
                location.href = $(this).data('url');
            }
        });


        if (!forceFollow) {
           
             initSubscribePanel();       
        }

        function initSubscribePanel() {
            $('#subscribe-panel').show();

                $('.btn-subscribe').click(function () {
                    $.modal({
                        title: '作者提示: 如何追书?',
                        text: '<div style="font-size:16px;color:#333">' +
                        '<div style="margin:5px auto;color:red">关注作者授权公众号，方便下次阅读</div>' +
                        '<img src="{$isgz.zhuishu}" style="width:70%"/>' +
                        '<div style="font-weight:bold;font-size:18px">长按识别上方二维码关注</div>' +
                        '</div>',
                        buttons: [{'text': '关闭'}]
                    });

                    $('.weui_dialog').css('top', '20%');

                    return false;
                });
        }


        // read user settings from cookie
         if (Cookies.get('size')) {
            applyFontSize(Cookies.get('size'));
        }
        if (Cookies.get('bg')) {
            applyBackground(Cookies.get('bg'));
        }

    
       
    });
</script>

    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?05b159841a45c81aa377c1fbda40f5bf";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



</body></html>